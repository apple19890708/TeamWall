import{a2 as C,a as d,c as p,d as s,b as _,q as n,s as k,j as m,u as B,M as L,r as $,a3 as y,o as j,Z as I,w as b,v as R,y as q,F as D,e as N,J as S,f as T}from"./index.d3194987.js";import{_ as U}from"./CardTitle.43c0fcdf.js";import{u as V,a as F}from"./useChat.ec892546.js";const M={class:"flex items-center"},O={class:"flex-1 pl-3"},z={class:"font-bold"},A={class:"w-[200px] overflow-hidden overflow-ellipsis whitespace-nowrap text-sm text-slate-500 md:w-80"},E={class:"text-gray text-xs"},J={props:{room:{type:Object,required:!0,default:()=>{}}},setup(f){const l=f,{handleRoom:a}=V(),{name:r,message:c,avatar:u}=C(l.room),o=e=>e?new Date(e).toLocaleString():"\u5C1A\u672A\u958B\u59CB\u5C0D\u8A71",t=()=>{a(l.room)};return(e,i)=>{var h,g,x,w,v;return d(),p("li",{onClick:t,class:"shadow-normal mb-4 flex h-[77px] cursor-pointer items-center justify-between rounded-lg border-2 border-black bg-white px-4"},[s("div",M,[_(k,{size:"40",imgUrl:(h=n(u))==null?void 0:h.url},null,8,["imgUrl"]),s("div",O,[s("p",z,m(n(r)),1),s("p",A,m((x=(g=n(c))==null?void 0:g[0])==null?void 0:x.message),1)])]),s("span",E,m(o((v=(w=n(c))==null?void 0:w[0])==null?void 0:v.createdAt)),1)])}}},Z={class:"text-center"},G={class:"flex items-center justify-center pt-8"},H=S(" \u8F09\u5165\u4E2D "),W={setup(f){const l=B(),a=L([]),r=$(!0),c=({roomId:o,msg:t})=>{const e=a.findIndex(i=>i.roomId===o);e>-1&&(a[e].message=[t])};y.on("updateChatRecord",c);const u=async()=>{var o;try{r.value=!0;const t=await F.record(),{data:{status:e,chatRecord:i}}=t;e&&Object.assign(a,i)}catch(t){const e=(o=t.response.data)==null?void 0:o.message;e&&l.error(e)}finally{r.value=!1}};return j(()=>{u()}),I(()=>{y.off("updateChatRecord",c)}),(o,t)=>(d(),p("section",null,[_(U,{title:"\u804A\u5929\u5BA4"}),s("ul",null,[b(s("li",Z," \u7121\u804A\u5929\u8A18\u9304 ",512),[[R,!r.value&&n(a).length===0]]),b(s("li",G,[H,_(q,{class:"ml-1 h-4 w-4 animate-spin"})],512),[[R,r.value]]),(d(!0),p(D,null,N(n(a),e=>(d(),T(J,{key:e==null?void 0:e.roomId,room:e},null,8,["room"]))),128))])]))}};export{W as default};
